{
  "version": 3,
  "sources": ["../../../src/util.js", "../../../src/api_data.js", "../../../src/db.js", "../../../src/api_alarm.js", "../../../src/api_push.js", "../../../src/crawler.js", "../../../src/webpush.js", "../../../src/api_refresh.js", "../../../src/index.js"],
  "sourceRoot": "D:\\Python_Save\\search_tennis_cloudflared\\Workers\\.wrangler\\tmp\\deploy-V0ce80",
  "sourcesContent": ["export function json(data, status = 200) {\r\n  return new Response(JSON.stringify(data), {\r\n    status,\r\n    headers: { \"Content-Type\": \"application/json; charset=utf-8\" }\r\n  });\r\n}\r\n\r\nexport function getCourtGroup(title = \"\") {\r\n  return title\r\n    .replace(/\\[.*?\\]/g, \"\")\r\n    .split(\"\uD14C\uB2C8\uC2A4\uC7A5\")[0]\r\n    .trim();\r\n}\r\n\r\nexport function buildCourtGroupMap(facilities) {\r\n  const map = {};\r\n  for (const [cid, info] of Object.entries(facilities || {})) {\r\n    const group = getCourtGroup(info.title || \"\");\r\n    if (!group) continue;\r\n    map[group] ??= [];\r\n    map[group].push(String(cid));\r\n  }\r\n  return map;\r\n}\r\n\r\nexport function flattenSlots(facilities, availability) {\r\n  const slots = [];\r\n  for (const [cid, days] of Object.entries(availability || {})) {\r\n    const title = facilities?.[cid]?.title || \"\";\r\n    for (const [date, items] of Object.entries(days || {})) {\r\n      for (const s of (items || [])) {\r\n        const time = s.timeContent;\r\n        if (!time) continue;\r\n        slots.push({\r\n          cid: String(cid),\r\n          court_title: title,\r\n          date: String(date),\r\n          time: String(time),\r\n          resveId: s.resveId || cid,\r\n          key: `${cid}|${date}|${time}`\r\n        });\r\n      }\r\n    }\r\n  }\r\n  return slots;\r\n}\r\n\r\nexport function makeReserveLink(resveId) {\r\n  const base = \"https://publicsports.yongin.go.kr/publicsports/sports/selectFcltyRceptResveViewU.do\";\r\n  return `${base}?key=4236&resveId=${encodeURIComponent(resveId)}&pageUnit=8&pageIndex=1&checkSearchMonthNow=false`;\r\n}\r\n\r\nexport async function sha256Hex(text) {\r\n  const enc = new TextEncoder().encode(text);\r\n  const hash = await crypto.subtle.digest(\"SHA-256\", enc);\r\n  return [...new Uint8Array(hash)].map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\n// \uAC04\uB2E8 \uB3D9\uC2DC\uC131 \uC81C\uD55C\r\nexport async function pMap(items, concurrency, fn) {\r\n  const ret = [];\r\n  let i = 0;\r\n  const workers = Array.from({ length: Math.max(1, concurrency) }, async () => {\r\n    while (i < items.length) {\r\n      const idx = i++;\r\n      ret[idx] = await fn(items[idx], idx);\r\n    }\r\n  });\r\n  await Promise.all(workers);\r\n  return ret;\r\n}\r\n\r\nexport function kstNowISOString() {\r\n  // KST = UTC+9\r\n  const now = new Date(Date.now() + 9 * 60 * 60 * 1000);\r\n  return now.toISOString();\r\n}\r\n\r\nexport function yyyymmddKST(date = new Date()) {\r\n  const d = new Date(date.getTime() + 9 * 60 * 60 * 1000);\r\n  const y = d.getUTCFullYear();\r\n  const m = String(d.getUTCMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getUTCDate()).padStart(2, \"0\");\r\n  return `${y}${m}${dd}`;\r\n}\r\n", "import { json } from \"./util\";\r\n\r\nexport async function handleData(_req, env) {\r\n  const raw = await env.CACHE.get(\"DATA_JSON\");\r\n  if (!raw) {\r\n    return json({ facilities: {}, availability: {}, updated_at: null });\r\n  }\r\n  return new Response(raw, {\r\n    headers: {\r\n    \"Content-Type\": \"application/json; charset=utf-8\",\r\n    \"Cache-Control\": \"no-store, no-cache, must-revalidate\",\r\n    \"Pragma\": \"no-cache\"\r\n    }\r\n  });\r\n}\r\n", "const DB_BINDING = \"yongin_tennis_db\";\r\n\r\nexport async function dbAll(env, sql, params = []) {\r\n  return env[DB_BINDING].prepare(sql).bind(...params).all();\r\n}\r\nexport async function dbGet(env, sql, params = []) {\r\n  return env[DB_BINDING].prepare(sql).bind(...params).first();\r\n}\r\nexport async function dbRun(env, sql, params = []) {\r\n  return env[DB_BINDING].prepare(sql).bind(...params).run();\r\n}\r\n", "import { json } from \"./util\";\r\nimport { dbAll, dbRun } from \"./db\";\r\n\r\nexport async function handleAlarm(req, env) {\r\n  const url = new URL(req.url);\r\n\r\n  if (url.pathname === \"/api/alarm/add\" && req.method === \"POST\") {\r\n    const body = await req.json().catch(() => ({}));\r\n    const subscription_id = body.subscription_id;\r\n    const court_group = body.court_group;\r\n    const date_raw = body.date; // YYYY-MM-DD\r\n\r\n    if (!subscription_id || !court_group || !date_raw) return json({ error: \"invalid request\" }, 400);\r\n    const date = String(date_raw).replaceAll(\"-\", \"\"); // YYYYMMDD\r\n\r\n    const r = await env.DB.prepare(`\r\n      INSERT INTO alarms (subscription_id, court_group, date)\r\n      VALUES (?, ?, ?)\r\n      ON CONFLICT(subscription_id, court_group, date) DO NOTHING\r\n    `).bind(subscription_id, court_group, date).run();\r\n\r\n    if (r.changes === 0) return json({ status: \"duplicate\" });\r\n    return json({ status: \"added\" });\r\n  }\r\n\r\n  if (url.pathname === \"/api/alarm/list\" && req.method === \"GET\") {\r\n    const subscription_id = url.searchParams.get(\"subscription_id\");\r\n    if (!subscription_id) return json([]);\r\n\r\n    const rows = await dbAll(env, `\r\n      SELECT court_group, date, created_at\r\n      FROM alarms\r\n      WHERE subscription_id = ?\r\n      ORDER BY created_at DESC\r\n    `, [subscription_id]);\r\n\r\n    return json(rows.results || []);\r\n  }\r\n\r\n  if (url.pathname === \"/api/alarm/delete\" && req.method === \"POST\") {\r\n    const body = await req.json().catch(() => ({}));\r\n    const subscription_id = body.subscription_id;\r\n    const court_group = body.court_group;\r\n    const date = body.date; // YYYYMMDD (\uD504\uB860\uD2B8\uC5D0\uC11C \uADF8\uB300\uB85C \uB0B4\uB824\uC634)\r\n\r\n    if (!subscription_id || !court_group || !date) return json({ error: \"invalid request\" }, 400);\r\n\r\n    await dbRun(env, `\r\n      DELETE FROM alarms\r\n      WHERE subscription_id=? AND court_group=? AND date=?\r\n    `, [subscription_id, court_group, date]);\r\n\r\n    return json({ status: \"deleted\" });\r\n  }\r\n\r\n  return new Response(\"Not Found\", { status: 404 });\r\n}\r\n", "import { json } from \"./util\";\r\nimport { dbRun } from \"./db\";\r\nimport { sha256Hex } from \"./util\";\r\n\r\nexport async function handlePushSubscribe(req, env) {\r\n  const sub = await req.json().catch(() => null);\r\n  if (!sub) return json({ error: \"no subscription\" }, 400);\r\n\r\n  const endpoint = sub.endpoint;\r\n  const keys = sub.keys || {};\r\n  const p256dh = keys.p256dh;\r\n  const auth = keys.auth;\r\n\r\n  if (!endpoint || !p256dh || !auth)\r\n    return json({ error: \"invalid subscription\" }, 400);\r\n\r\n  const subscription_id = await sha256Hex(endpoint);\r\n\r\n  await dbRun(\r\n    env,\r\n    `\r\n    INSERT INTO push_subscriptions (id, endpoint, p256dh, auth)\r\n    VALUES (?, ?, ?, ?)\r\n    ON CONFLICT(id) DO UPDATE SET\r\n      endpoint=excluded.endpoint,\r\n      p256dh=excluded.p256dh,\r\n      auth=excluded.auth\r\n  `,\r\n    [subscription_id, endpoint, p256dh, auth]\r\n  );\r\n\r\n  return json({ subscription_id });\r\n}\r\n", "import { pMap } from \"./util\";\r\n\r\nconst BASE_URL = \"https://publicsports.yongin.go.kr/publicsports/sports/selectFcltyRceptResveListU.do\";\r\nconst TIME_URL = \"https://publicsports.yongin.go.kr/publicsports/sports/selectRegistTimeByChosenDateFcltyRceptResveApply.do\";\r\n\r\nconst HEADERS = {\r\n  \"User-Agent\": \"Mozilla/5.0\",\r\n  \"Referer\": BASE_URL\r\n};\r\n\r\nasync function fetchText(url, init = {}) {\r\n  const res = await fetch(url, { ...init, headers: { ...(init.headers || {}), ...HEADERS } });\r\n  return await res.text();\r\n}\r\n\r\nasync function fetchJson(url, init = {}) {\r\n  const res = await fetch(url, { ...init, headers: { ...(init.headers || {}), ...HEADERS } });\r\n  return await res.json();\r\n}\r\n\r\nfunction extractMaxPage(html) {\r\n  const m = [...html.matchAll(/pageIndex=(\\d+)/g)].map(x => parseInt(x[1], 10)).filter(n => Number.isFinite(n));\r\n  return m.length ? Math.max(...m) : 1;\r\n}\r\n\r\nfunction parseFacilities(html) {\r\n  // reserve_box_item \uB2E8\uC704\uB85C \uB300\uCDA9 \uBE14\uB85D \uD30C\uC2F1 (\uC6D0\uBCF8 \uAD6C\uC870 \uBCC0\uACBD\uC5D0 \uB300\uBE44\uD574 \uB113\uAC8C \uC7A1\uC74C)\r\n  const blocks = html.split(\"reserve_box_item\");\r\n  const out = {};\r\n  for (const b of blocks) {\r\n    const rid = (b.match(/resveId=(\\d+)/) || [])[1];\r\n    if (!rid) continue;\r\n\r\n    // title/location\uC740 HTML \uAD6C\uC870\uAC00 \uBC14\uB014 \uC218 \uC788\uC5B4\uC11C strip \uB300\uCDA9\r\n    let title = \"\";\r\n    let location = \"\";\r\n\r\n    const titleMatch = b.match(/reserve_title[^>]*>([\\s\\S]*?)<\\/div>/);\r\n    if (titleMatch) {\r\n      const raw = titleMatch[1]\r\n        .replace(/<[^>]+>/g, \" \")\r\n        .replace(/\\s+/g, \" \")\r\n        .trim();\r\n      title = raw;\r\n    }\r\n\r\n    const locMatch = b.match(/reserve_position[^>]*>([\\s\\S]*?)<\\/div>/);\r\n    if (locMatch) {\r\n      location = locMatch[1].replace(/<[^>]+>/g, \" \").replace(/\\s+/g, \" \").trim();\r\n      // title \uC548\uC5D0 location\uC774 \uC11E\uC5EC \uB4E4\uC5B4\uC624\uBA74 \uC81C\uAC70(\uB300\uCDA9)\r\n      if (title && location) title = title.replace(location, \"\").trim();\r\n    }\r\n\r\n    out[rid] = { title: title || `\uC2DC\uC124 ${rid}`, location };\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction listDatesAhead(daysAhead) {\r\n  const dates = [];\r\n  const now = new Date(Date.now() + 9*60*60*1000); // KST\r\n  // \"\uB0B4\uC77C\uBD80\uD130\" \uC2DC\uC791(\uAE30\uC874 python)\r\n  for (let i = 1; i <= daysAhead; i++) {\r\n    const d = new Date(now.getTime() + i * 24*60*60*1000);\r\n    const y = d.getUTCFullYear();\r\n    const m = String(d.getUTCMonth()+1).padStart(2, \"0\");\r\n    const dd = String(d.getUTCDate()).padStart(2, \"0\");\r\n    dates.push(`${y}${m}${dd}`);\r\n  }\r\n  return dates;\r\n}\r\n\r\nasync function fetchTimesForDate(rid, dateVal) {\r\n  const body = new URLSearchParams({ dateVal, resveId: rid });\r\n  try {\r\n    const j = await fetchJson(TIME_URL, { method: \"POST\", body });\r\n    const list = j?.resveTmList || [];\r\n    // slot \uD615\uD0DC\uB97C \uD504\uB860\uD2B8\uC5D0 \uB9DE\uCDB0 \uD1B5\uC77C\r\n    return list.map(x => ({\r\n      timeContent: x.timeContent || x.resveTmNm || x.tmNm || \"\",\r\n      resveId: rid\r\n    })).filter(x => x.timeContent);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function runCrawl({ daysAhead = 45, concurrency = 15 } = {}) {\r\n  // 1) \uC2DC\uC124 \uBAA9\uB85D \uD398\uC774\uC9C0 1 \uB85C\uB4DC\r\n  const baseParams = new URLSearchParams({\r\n    searchFcltyFieldNm: \"ITEM_01\",\r\n    pageUnit: \"20\",\r\n    pageIndex: \"1\",\r\n    checkSearchMonthNow: \"false\"\r\n  });\r\n\r\n  const firstHtml = await fetchText(`${BASE_URL}?${baseParams.toString()}`);\r\n  const maxPage = extractMaxPage(firstHtml);\r\n\r\n  const facilities = { ...parseFacilities(firstHtml) };\r\n\r\n  // 2) \uB098\uBA38\uC9C0 \uD398\uC774\uC9C0 \uBCD1\uB82C\r\n  const pages = [];\r\n  for (let p = 2; p <= maxPage; p++) {\r\n    const params = new URLSearchParams(baseParams);\r\n    params.set(\"pageIndex\", String(p));\r\n    pages.push(`${BASE_URL}?${params.toString()}`);\r\n  }\r\n\r\n  const htmls = await pMap(pages, Math.min(concurrency, 10), async (u) => fetchText(u));\r\n  for (const h of htmls) Object.assign(facilities, parseFacilities(h));\r\n\r\n  // 3) \uAC01 \uC2DC\uC124 rid \u00D7 datesAhead \uC870\uD68C (\uB3D9\uC2DC\uC131 \uC81C\uD55C)\r\n  const rids = Object.keys(facilities);\r\n  const dates = listDatesAhead(daysAhead);\r\n\r\n  const availability = {};\r\n\r\n  // \uC2DC\uC124 \uB2E8\uC704\uB85C \uC21C\uD68C\uD558\uB418, \uB0B4\uBD80 \uB0A0\uC9DC\uB294 \uC81C\uD55C concurrency\uB85C\r\n  for (const rid of rids) {\r\n    const results = await pMap(dates, concurrency, async (dateVal) => {\r\n      const slots = await fetchTimesForDate(rid, dateVal);\r\n      return { dateVal, slots };\r\n    });\r\n\r\n    for (const { dateVal, slots } of results) {\r\n      if (!slots || slots.length === 0) continue;\r\n      availability[rid] ??= {};\r\n      availability[rid][dateVal] = slots;\r\n    }\r\n  }\r\n\r\n  return { facilities, availability };\r\n}\r\n", "/**\r\n * Cloudflare Workers Web Push (aes128gcm) + VAPID (ES256)\r\n * - subscription: { endpoint: string, keys: { p256dh: base64url, auth: base64url } }\r\n * - env needs: VAPID_PRIVATE_KEY (base64url), VAPID_PUBLIC_KEY (base64url), VAPID_SUBJECT (\"mailto:..\")\r\n */\r\n\r\nfunction b64urlToBytes(b64url) {\r\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4);\r\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n  const bin = atob(b64);\r\n  const out = new Uint8Array(bin.length);\r\n  for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i);\r\n  return out;\r\n}\r\n\r\nfunction bytesToB64url(bytes) {\r\n  let bin = \"\";\r\n  for (let i = 0; i < bytes.length; i++) bin += String.fromCharCode(bytes[i]);\r\n  const b64 = btoa(bin).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/g, \"\");\r\n  return b64;\r\n}\r\n\r\nfunction concatBytes(...arrs) {\r\n  const len = arrs.reduce((s, a) => s + a.length, 0);\r\n  const out = new Uint8Array(len);\r\n  let off = 0;\r\n  for (const a of arrs) {\r\n    out.set(a, off);\r\n    off += a.length;\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction u16be(n) {\r\n  return new Uint8Array([(n >> 8) & 0xff, n & 0xff]);\r\n}\r\n\r\nfunction textBytes(s) {\r\n  return new TextEncoder().encode(s);\r\n}\r\n\r\nfunction endpointAudience(endpoint) {\r\n  const u = new URL(endpoint);\r\n  return `${u.protocol}//${u.host}`;\r\n}\r\n\r\nasync function hkdfExtract(saltBytes, ikmBytes) {\r\n  const saltKey = await crypto.subtle.importKey(\"raw\", saltBytes, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]);\r\n  const prk = await crypto.subtle.sign(\"HMAC\", saltKey, ikmBytes);\r\n  return new Uint8Array(prk);\r\n}\r\n\r\nasync function hkdfExpand(prkBytes, infoBytes, length) {\r\n  const prkKey = await crypto.subtle.importKey(\"raw\", prkBytes, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]);\r\n  const out = new Uint8Array(length);\r\n  let prev = new Uint8Array(0);\r\n  let pos = 0;\r\n  let counter = 1;\r\n\r\n  while (pos < length) {\r\n    const data = concatBytes(prev, infoBytes, new Uint8Array([counter]));\r\n    const t = new Uint8Array(await crypto.subtle.sign(\"HMAC\", prkKey, data));\r\n    const take = Math.min(t.length, length - pos);\r\n    out.set(t.slice(0, take), pos);\r\n    pos += take;\r\n    prev = t;\r\n    counter++;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * aes128gcm Web Push encryption per RFC 8291\r\n */\r\nasync function encryptAes128Gcm({ subscription, payloadBytes }) {\r\n  const clientPub = b64urlToBytes(subscription.keys.p256dh); // 65 bytes uncompressed\r\n  const authSecret = b64urlToBytes(subscription.keys.auth); // 16 bytes\r\n\r\n  // Import client's public ECDH key\r\n  const clientKey = await crypto.subtle.importKey(\r\n    \"raw\",\r\n    clientPub,\r\n    { name: \"ECDH\", namedCurve: \"P-256\" },\r\n    false,\r\n    []\r\n  );\r\n\r\n  // Generate server ephemeral ECDH keypair\r\n  const serverKp = await crypto.subtle.generateKey(\r\n    { name: \"ECDH\", namedCurve: \"P-256\" },\r\n    true,\r\n    [\"deriveBits\"]\r\n  );\r\n\r\n  const sharedSecretBits = await crypto.subtle.deriveBits(\r\n    { name: \"ECDH\", public: clientKey },\r\n    serverKp.privateKey,\r\n    256\r\n  );\r\n  const sharedSecret = new Uint8Array(sharedSecretBits);\r\n\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n\r\n  // PRK = HKDF-Extract(authSecret, sharedSecret) using \"Content-Encoding: auth\\0\" as info in expand step\r\n  const prkAuth = await hkdfExtract(authSecret, sharedSecret);\r\n  const prk = await hkdfExpand(prkAuth, textBytes(\"Content-Encoding: auth\\0\"), 32);\r\n\r\n  // Build \"context\" = len(clientPub) || clientPub || len(serverPub) || serverPub\r\n  const serverPubRaw = new Uint8Array(await crypto.subtle.exportKey(\"raw\", serverKp.publicKey)); // 65 bytes\r\n  const context = concatBytes(u16be(clientPub.length), clientPub, u16be(serverPubRaw.length), serverPubRaw);\r\n\r\n  // CEK & Nonce derivation\r\n  const cekInfo = concatBytes(textBytes(\"Content-Encoding: aes128gcm\\0\"), textBytes(\"P-256\\0\"), context);\r\n  const nonceInfo = concatBytes(textBytes(\"Content-Encoding: nonce\\0\"), textBytes(\"P-256\\0\"), context);\r\n\r\n  const prkSalt = await hkdfExtract(salt, prk);\r\n  const cek = await hkdfExpand(prkSalt, cekInfo, 16);\r\n  const nonce = await hkdfExpand(prkSalt, nonceInfo, 12);\r\n\r\n  // Plaintext formatting: payload || 0x02 (padding delimiter), no extra padding\r\n  const plaintext = concatBytes(payloadBytes, new Uint8Array([0x02]));\r\n\r\n  // AES-GCM encrypt\r\n  const aesKey = await crypto.subtle.importKey(\"raw\", cek, { name: \"AES-GCM\" }, false, [\"encrypt\"]);\r\n  const ciphertext = new Uint8Array(\r\n    await crypto.subtle.encrypt({ name: \"AES-GCM\", iv: nonce }, aesKey, plaintext)\r\n  );\r\n\r\n  return {\r\n    ciphertext,\r\n    salt,\r\n    serverPubRaw, // for Crypto-Key: dh=\r\n  };\r\n}\r\n\r\n/**\r\n * VAPID JWT (ES256) signing using JWK constructed from:\r\n * - env.VAPID_PRIVATE_KEY (d) base64url\r\n * - env.VAPID_PUBLIC_KEY (uncompressed 65 bytes => x,y)\r\n */\r\nasync function createVapidAuthorization({ endpoint, env }) {\r\n  const aud = endpointAudience(endpoint);\r\n  const exp = Math.floor(Date.now() / 1000) + 12 * 60 * 60; // 12h\r\n  const sub = env.VAPID_SUBJECT?.startsWith(\"mailto:\") ? env.VAPID_SUBJECT : `mailto:${env.VAPID_SUBJECT}`;\r\n\r\n  const header = { typ: \"JWT\", alg: \"ES256\" };\r\n  const payload = { aud, exp, sub };\r\n\r\n  const enc = (obj) => {\r\n    const json = JSON.stringify(obj);\r\n    return bytesToB64url(textBytes(json));\r\n  };\r\n\r\n  const signingInput = `${enc(header)}.${enc(payload)}`;\r\n\r\n  // Build JWK\r\n  const pub = b64urlToBytes(env.VAPID_PUBLIC_KEY); // 65 bytes: 0x04 || x(32) || y(32)\r\n  if (pub.length !== 65 || pub[0] !== 0x04) throw new Error(\"Invalid VAPID_PUBLIC_KEY format\");\r\n  const x = pub.slice(1, 33);\r\n  const y = pub.slice(33, 65);\r\n\r\n  const jwk = {\r\n    kty: \"EC\",\r\n    crv: \"P-256\",\r\n    x: bytesToB64url(x),\r\n    y: bytesToB64url(y),\r\n    d: env.VAPID_PRIVATE_KEY, // already base64url\r\n  };\r\n\r\n  const key = await crypto.subtle.importKey(\"jwk\", jwk, { name: \"ECDSA\", namedCurve: \"P-256\" }, false, [\"sign\"]);\r\n  const sigDer = new Uint8Array(await crypto.subtle.sign({ name: \"ECDSA\", hash: \"SHA-256\" }, key, textBytes(signingInput)));\r\n\r\n  // Web Push expects JOSE signature (r||s 64 bytes). WebCrypto returns DER for ECDSA, so convert.\r\n  const sigJose = derToJose(sigDer, 64);\r\n\r\n  const jwt = `${signingInput}.${bytesToB64url(sigJose)}`;\r\n\r\n  // Authorization: vapid t=..., k=...\r\n  // k is the VAPID public key (base64url, no padding)\r\n  return `vapid t=${jwt}, k=${env.VAPID_PUBLIC_KEY}`;\r\n}\r\n\r\n// Convert DER ECDSA signature to JOSE (r||s)\r\nfunction derToJose(derSig, joseLen) {\r\n  // Minimal DER parser for ECDSA signatures\r\n  // Structure: 0x30 len 0x02 rlen r 0x02 slen s\r\n  let i = 0;\r\n  if (derSig[i++] !== 0x30) throw new Error(\"Invalid DER signature\");\r\n  const seqLen = derSig[i++];\r\n  if (seqLen + 2 !== derSig.length && seqLen + 3 !== derSig.length) {\r\n    // tolerate some variants\r\n  }\r\n  if (derSig[i++] !== 0x02) throw new Error(\"Invalid DER signature (r)\");\r\n  const rLen = derSig[i++];\r\n  let r = derSig.slice(i, i + rLen);\r\n  i += rLen;\r\n\r\n  if (derSig[i++] !== 0x02) throw new Error(\"Invalid DER signature (s)\");\r\n  const sLen = derSig[i++];\r\n  let s = derSig.slice(i, i + sLen);\r\n\r\n  // Strip leading zeros\r\n  while (r.length > 1 && r[0] === 0x00) r = r.slice(1);\r\n  while (s.length > 1 && s[0] === 0x00) s = s.slice(1);\r\n\r\n  // Left pad to joseLen/2 each\r\n  const half = joseLen / 2;\r\n  const out = new Uint8Array(joseLen);\r\n  out.set(r.length > half ? r.slice(-half) : r, half - Math.min(r.length, half));\r\n  out.set(s.length > half ? s.slice(-half) : s, joseLen - Math.min(s.length, half));\r\n  return out;\r\n}\r\n\r\n/**\r\n * Main: send Web Push\r\n */\r\nexport async function sendWebPush({ subscription, title, body, ttl = 60, env }) {\r\n  if (!subscription?.endpoint || !subscription?.keys?.p256dh || !subscription?.keys?.auth) {\r\n    throw new Error(\"Invalid subscription object\");\r\n  }\r\n  if (!env?.VAPID_PRIVATE_KEY || !env?.VAPID_PUBLIC_KEY || !env?.VAPID_SUBJECT) {\r\n    throw new Error(\"Missing VAPID env vars (VAPID_PRIVATE_KEY, VAPID_PUBLIC_KEY, VAPID_SUBJECT)\");\r\n  }\r\n\r\n  const payloadObj = { title, body };\r\n  const payloadBytes = textBytes(JSON.stringify(payloadObj));\r\n\r\n  const { ciphertext, salt, serverPubRaw } = await encryptAes128Gcm({ subscription, payloadBytes });\r\n\r\n  const authorization = await createVapidAuthorization({ endpoint: subscription.endpoint, env });\r\n\r\n  const cryptoKey = `dh=${bytesToB64url(serverPubRaw)}; p256ecdsa=${env.VAPID_PUBLIC_KEY}`;\r\n  const encryption = `salt=${bytesToB64url(salt)}`;\r\n\r\n  const res = await fetch(subscription.endpoint, {\r\n    method: \"POST\",\r\n    headers: {\r\n      TTL: String(ttl),\r\n      \"Content-Type\": \"application/octet-stream\",\r\n      \"Content-Encoding\": \"aes128gcm\",\r\n      \"Crypto-Key\": cryptoKey,\r\n      \"Encryption\": encryption,\r\n      \"Authorization\": authorization,\r\n    },\r\n    body: ciphertext,\r\n  });\r\n\r\n  return res;\r\n}\r\n", "import { json, buildCourtGroupMap, flattenSlots, kstNowISOString, yyyymmddKST } from \"./util\";\r\nimport { dbAll, dbGet, dbRun } from \"./db\";\r\nimport { runCrawl } from \"./crawler\";\r\nimport { sendWebPush } from \"./webpush\";\r\n\r\n\r\n\r\nasync function cleanupOld(env) {\r\n  const today = yyyymmddKST(new Date());\r\n  await dbRun(env, `DELETE FROM alarms WHERE date < ?`, [today]);\r\n  await dbRun(env, `DELETE FROM baseline_slots WHERE date < ?`, [today]);\r\n  // sent_slots\uB294 \uD558\uB8E8\uB9CC \uC720\uC9C0\r\n  await dbRun(env, `DELETE FROM sent_slots WHERE sent_at < datetime('now','-1 day')`);\r\n}\r\n\r\nasync function sendPush(env, subscription, title, body) {\r\n  const res = await sendWebPush({\r\n    subscription,\r\n    title,\r\n    body,\r\n    ttl: 60,\r\n    env\r\n  });\r\n\r\n  // \uAD6C\uB3C5 \uB9CC\uB8CC(410/404)\uBA74 DB\uC5D0\uC11C \uAD6C\uB3C5 \uC0AD\uC81C(\uC120\uD0DD)\r\n  if (res.status === 410 || res.status === 404) {\r\n    // \uC5EC\uAE30\uC11C subscription_id\uB97C \uC54C\uACE0 \uC788\uC73C\uBA74 \uC0AD\uC81C\uD558\uBA74 \uB354 \uAE54\uB054\uD568\r\n    // (\uC9C0\uAE08 \uAD6C\uC870\uC5D0\uC120 subsMap \uD0A4\uAC00 subscription_id\uB77C\uC11C \uD638\uCD9C\uBD80\uC5D0\uC11C \uCC98\uB9AC \uAD8C\uC7A5)\r\n  }\r\n\r\n  if (!res.ok) {\r\n    const txt = await res.text().catch(() => \"\");\r\n    throw new Error(`WebPush failed: ${res.status} ${txt}`);\r\n  }\r\n}\r\n\r\n\r\nexport async function handleRefresh(req, env, ctx, opts = {}) {\r\n  const fromCron = opts.fromCron === true || !req;\r\n\r\n  let url = null;\r\n  if (req) {\r\n    url = new URL(req.url);\r\n  }\r\n\r\n  // \uD83D\uDD10 \uC218\uB3D9 \uD638\uCD9C\uB9CC \uD1A0\uD070 \uAC80\uC0AC\r\n  if (!fromCron) {\r\n    const token = url.searchParams.get(\"token\");\r\n    if (!token || token !== env.REFRESH_TOKEN) {\r\n      return new Response(\"forbidden\", { status: 403 });\r\n    }\r\n  }\r\n\r\n  console.log(\"[REFRESH] start\", fromCron ? \"cron\" : \"manual\");\r\n\r\n  // 0) \uC624\uB798\uB41C \uB370\uC774\uD130 \uC815\uB9AC\r\n  await cleanupOld(env);\r\n\r\n  // 1) \uD06C\uB864\uB9C1\r\n  const daysAhead = parseInt(env.DAYS_AHEAD || \"45\", 10);\r\n  const concurrency = parseInt(env.CONCURRENCY || \"15\", 10);\r\n\r\n  const { facilities, availability } = await runCrawl({ daysAhead, concurrency });\r\n\r\n  console.log(\r\n    \"[REFRESH] crawl result\",\r\n    Object.keys(facilities).length,\r\n    Object.keys(availability).length\r\n  );\r\n\r\n  const updated_at = kstNowISOString();\r\n\r\n  // 2) KV \uC800\uC7A5\r\n  const payload = JSON.stringify({ facilities, availability, updated_at });\r\n  await env.CACHE.put(\"DATA_JSON\", payload, { expirationTtl: 120 });\r\n\r\n  console.log(\"[REFRESH] cache updated\");\r\n\r\n  // \u2B07\uFE0F\u2B07\uFE0F\u2B07\uFE0F \uC5EC\uAE30\uC11C\uBD80\uD130 \uC54C\uB78C \uB85C\uC9C1 \u2B07\uFE0F\u2B07\uFE0F\u2B07\uFE0F\r\n\r\n\r\n  // 3) \uC54C\uB78C \uCC98\uB9AC\r\n  const alarms = await dbAll(env, `SELECT subscription_id, court_group, date FROM alarms`);\r\n  if (!alarms.results?.length) return fromCron ? undefined : new Response(\"ok\");\r\n\r\n  const subs = await dbAll(env, `SELECT * FROM push_subscriptions`);\r\n  const subsMap = {};\r\n  for (const s of (subs.results || [])) {\r\n    subsMap[s.id] = {\r\n      endpoint: s.endpoint,\r\n      keys: { p256dh: s.p256dh, auth: s.auth }\r\n    };\r\n  }\r\n\r\n  const courtGroupMap = buildCourtGroupMap(facilities);\r\n  const currentSlots = flattenSlots(facilities, availability);\r\n\r\n  let fired = 0;\r\n\r\n  for (const alarm of alarms.results) {\r\n    const subscription_id = alarm.subscription_id;\r\n    const group = alarm.court_group;\r\n    const date = alarm.date;\r\n\r\n    const groupCids = courtGroupMap[group] || [];\r\n    if (!groupCids.length) continue;\r\n\r\n    // baseline \uB85C\uB4DC\r\n    const baselineRows = await dbAll(env, `\r\n      SELECT time_content\r\n      FROM baseline_slots\r\n      WHERE subscription_id=? AND court_group=? AND date=?\r\n    `, [subscription_id, group, date]);\r\n\r\n    const baseline = new Set((baselineRows.results || []).map(r => r.time_content));\r\n\r\n    // \uCD5C\uCD08 baseline \uC5C6\uC73C\uBA74: baseline\uB9CC \uC313\uACE0 \uC54C\uB78C X\r\n    if (baseline.size === 0) {\r\n      const times = new Set(\r\n        currentSlots\r\n          .filter(s => groupCids.includes(s.cid) && s.date === date)\r\n          .map(s => s.time)\r\n      );\r\n\r\n      for (const t of times) {\r\n        await dbRun(env, `\r\n          INSERT INTO baseline_slots (subscription_id, court_group, date, time_content)\r\n          VALUES (?, ?, ?, ?)\r\n          ON CONFLICT(subscription_id, court_group, date, time_content) DO NOTHING\r\n        `, [subscription_id, group, date, t]);\r\n      }\r\n      continue;\r\n    }\r\n\r\n    // \uC2E0\uADDC \uC2AC\uB86F\uB9CC \uBC1C\uC1A1\r\n    for (const slot of currentSlots) {\r\n      if (!groupCids.includes(slot.cid)) continue;\r\n      if (slot.date !== date) continue;\r\n      if (baseline.has(slot.time)) continue;\r\n\r\n      const sub = subsMap[subscription_id];\r\n      if (!sub) continue;\r\n\r\n      const slot_key = `${group}|${date}|${slot.time}`;\r\n\r\n      const already = await dbGet(env, `\r\n        SELECT 1 FROM sent_slots WHERE subscription_id=? AND slot_key=? LIMIT 1\r\n      `, [subscription_id, slot_key]);\r\n\r\n      if (already) continue;\r\n\r\n      await sendPush(env, sub, \"\uD83C\uDFBE \uC608\uC57D \uAC00\uB2A5 \uC54C\uB9BC\", `${group} ${date} ${slot.time}`);\r\n      fired++;\r\n\r\n      // baseline + sent \uAE30\uB85D\r\n      await dbRun(env, `\r\n        INSERT INTO baseline_slots (subscription_id, court_group, date, time_content)\r\n        VALUES (?, ?, ?, ?)\r\n        ON CONFLICT(subscription_id, court_group, date, time_content) DO NOTHING\r\n      `, [subscription_id, group, date, slot.time]);\r\n\r\n      await dbRun(env, `\r\n        INSERT INTO sent_slots (subscription_id, slot_key)\r\n        VALUES (?, ?)\r\n        ON CONFLICT(subscription_id, slot_key) DO NOTHING\r\n      `, [subscription_id, slot_key]);\r\n\r\n      baseline.add(slot.time);\r\n\r\n      console.log(\"[REFRESH] start\", new Date().toISOString());\r\n      console.log(\r\n        \"[REFRESH] crawl result\",\r\n        Object.keys(facilities).length,\r\n        Object.keys(availability).length\r\n      );\r\n      await env.CACHE.put(\"DATA_JSON\", payload, { expirationTtl: 120 });\r\n      console.log(\"[REFRESH] cache updated\");\r\n\r\n\r\n    }\r\n  }\r\n\r\n  return fromCron ? undefined : json({ status: \"ok\", fired });\r\n}\r\n", "import { handleData } from \"./api_data\";\r\nimport { handleAlarm } from \"./api_alarm\";\r\nimport { handlePushSubscribe } from \"./api_push\";\r\nimport { handleRefresh } from \"./api_refresh\";\r\n\r\nconst corsHeaders = {\r\n  \"Access-Control-Allow-Origin\": \"*\",\r\n  \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\r\n  \"Access-Control-Allow-Headers\": \"Content-Type\"\r\n};\r\n\r\nexport default {\r\n  async fetch(req, env, ctx) {\r\n    const url = new URL(req.url);\r\n    const path = url.pathname;\r\n\r\n    // \uD83D\uDD25 CORS preflight (\uCD5C\uC0C1\uB2E8, \uB2E8 \uD55C \uBC88)\r\n    if (req.method === \"OPTIONS\") {\r\n      return new Response(null, { status: 204, headers: corsHeaders });\r\n    }\r\n\r\n    if (path === \"/api/data\") {\r\n      const res = await handleData(req, env);\r\n      return new Response(res.body, {\r\n        status: res.status,\r\n        headers: { ...Object.fromEntries(res.headers), ...corsHeaders }\r\n      });\r\n    }\r\n\r\n    if (path.startsWith(\"/api/alarm\")) {\r\n      const res = await handleAlarm(req, env);\r\n      return new Response(res.body, {\r\n        status: res.status,\r\n        headers: { ...Object.fromEntries(res.headers), ...corsHeaders }\r\n      });\r\n    }\r\n\r\n    if (path === \"/api/push/subscribe\") {\r\n      if (req.method !== \"POST\") {\r\n        return new Response(\"Method Not Allowed\", {\r\n          status: 405,\r\n          headers: corsHeaders\r\n        });\r\n      }\r\n      const res = await handlePushSubscribe(req, env);\r\n      return new Response(res.body, {\r\n        status: res.status,\r\n        headers: { ...Object.fromEntries(res.headers), ...corsHeaders }\r\n      });\r\n    }\r\n\r\n    if (path === \"/api/refresh\") {\r\n      const token = url.searchParams.get(\"token\");\r\n      if (token !== env.REFRESH_TOKEN) {\r\n        return new Response(\"unauthorized\", {\r\n          status: 401,\r\n          headers: corsHeaders\r\n        });\r\n      }\r\n      return handleRefresh(req, env, ctx);\r\n    }\r\n\r\n    if (path === \"/ping\") {\r\n      return new Response(\"pong\", { headers: corsHeaders });\r\n    }\r\n\r\n    return new Response(\"Not Found\", { status: 404, headers: corsHeaders });\r\n  },\r\n\r\n  async scheduled(event, env, ctx) {\r\n    ctx.waitUntil(handleRefresh(null, env, ctx, { fromCron: true }));\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": ["json"]
}
